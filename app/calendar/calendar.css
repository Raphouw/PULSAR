/* --- BASE --- */
body {
  background-color: #0f0f13;
  transition: background 1s ease;
}
.scrollable-content::-webkit-scrollbar { display: none; }

.calendar-wrapper-3d { 
  transform-style: preserve-3d; 
  transform: rotateX(var(--rot-x, 0deg)) rotateY(var(--rot-y, 0deg)) scale(0.95); 
  transition: transform 0.1s ease-out; 
  will-change: transform; 
}

@keyframes sky-move {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.day-cell:hover {
    transition: all 0.2s ease !important;
}

.day-cell {
    transition: all 0.2s ease !important;
}

[style*="dayCell"] {
    transition: all 0.2s ease !important;
}

[style*="dayCell"]:hover {
    /* Vos styles de hover */
    transform: translateY(-2px);
    border-color: var(--hover-color, currentColor);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

[style*="dayCell"]:not(:hover) {
    /* Force le retour aux styles initiaux */
    transform: translateY(0) !important;
    box-shadow: none !important;
}

/* Base commune pour toutes les ambiances */
body.bg-phase-dawn,
body.bg-phase-day,
body.bg-phase-dusk,
body.bg-phase-night {
  background-size: 300% 300% !important;
  animation: sky-move 30s ease infinite !important; /* Boucle lente de 30s */
  transition: background 2s ease; /* Transition douce si on change d'heure */
}

/* 1. NUIT (Deep Space) */
body.bg-phase-night {
  background: linear-gradient(125deg, #020617 0%, #0f172a 40%, #1e1b4b 100%) !important;
}

/* 2. AUBE (L'espoir, froid mais color√©) */
body.bg-phase-dawn {
  background: linear-gradient(125deg, #1e3a8a 0%, #6366f1 50%, #f472b6 100%) !important;
}

/* 3. JOUR (Bleu profond, dynamique) */
body.bg-phase-day {
  background: linear-gradient(125deg, #0369a1 0%, #0ea5e9 50%, #38bdf8 100%) !important;
}

/* 4. CR√âPUSCULE / SUNSET (Vaporwave, intense) */
body.bg-phase-dusk {
  background: linear-gradient(125deg, #312e81 0%, #be185d 50%, #ea580c 100%) !important;
}

.virtual-ride-stripes {
  position: relative;
}

/* On utilise ::before pour superposer les rayures sans toucher au fond color√© */
.virtual-ride-stripes::before {
  content: '';
  position: absolute;
  inset: 0;
  /* Rayures noires semi-transparentes inclin√©es */
  background: repeating-linear-gradient(
    -45deg,
    transparent,
    transparent 3px,
    rgba(0, 0, 0, 0.5) 25px,
    rgba(0, 0, 0, 0.3) 10px
  );
  z-index: 0;
  pointer-events: none; /* Laisse passer les clics */
  border-radius: inherit;
}

/* On s'assure que le texte et les pastilles restent AU-DESSUS des rayures */
.virtual-ride-stripes > * {
  position: relative;
  z-index: 2;
}

@keyframes fog-move { 0% { background-position: 0 0; } 100% { background-position: -200% 0; } }

/* --- SHOP --- */
.shop-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1rem; }

.shop-tabs { display: flex; gap: 1rem; margin-bottom: 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 1rem;}
.shop-tab { background: transparent; border: none; color: #666; font-weight: 700; font-size: 0.9rem; cursor: pointer; padding: 0.5rem 1rem; transition: all 0.2s; border-radius: 8px; }
.shop-tab.active { background: rgba(255,255,255,0.1); color: #fff; }

/* --- PARTICULES (PHYSIQUE) --- */
.particle-base {
  position: fixed; pointer-events: none; z-index: 9999; border-radius: 50%;
}

@keyframes float-up {
  0% { transform: translate(-50%, -50%) translateY(0) scale(1); opacity: 1; }
  100% { transform: translate(-50%, -50%) translateY(-100px) scale(0); opacity: 0; }
}
.physic-float { animation: float-up 1s ease-out forwards; }

@keyframes fall-down {
  0% { transform: translate(-50%, -50%) translateY(0) scale(1); opacity: 1; }
  100% { transform: translate(-50%, -50%) translateY(100px) scale(0.5); opacity: 0; }
}
.physic-gravity { animation: fall-down 1s linear forwards; }

@keyframes fire-rise {
  0% { transform: translate(-50%, -50%) translateY(0) scale(1.5); opacity: 0.8; }
  100% { transform: translate(-50%, -50%) translateY(-60px) translateX(var(--rx)) scale(0); opacity: 0; }
}
.physic-fire { animation: fire-rise 0.6s ease-out forwards; filter: blur(1px); }

@keyframes blast-out {
  0% { transform: translate(-50%, -50%) translate(0, 0) scale(1); opacity: 1; }
  100% { transform: translate(-50%, -50%) translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
}
.physic-blast { animation: blast-out 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

@keyframes spiral-spin {
  0% { transform: translate(-50%, -50%) rotate(0deg) translateX(10px) scale(0); opacity: 0; }
  50% { opacity: 1; }
  100% { transform: translate(-50%, -50%) rotate(360deg) translateX(60px) scale(1); opacity: 0; }
}
.physic-spiral { animation: spiral-spin 1s ease-out forwards; }

@keyframes zap-flash {
  0% { opacity: 0; } 10% { opacity: 1; } 100% { opacity: 0; transform: scale(0.5); }
}
.physic-zap { 
  animation: zap-flash 0.2s ease-out forwards; width: 30px !important; height: 2px !important; border-radius: 0 !important; box-shadow: 0 0 10px currentColor;
}
/* Bulle sp√©cifique */
.physic-bubble { animation: float-up 3s ease-in forwards; border-radius: 50%; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); }


/* --- EFFETS PASSIFS --- */
@keyframes reactor-spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
.today-reactor { position: relative !important; z-index: 1; border: none !important; background: transparent !important; overflow: hidden !important; }
.today-reactor::before { content: ''; position: absolute; z-index: -2; top: 50%; left: 50%; width: 300%; height: 300%; transform: translate(-50%, -50%); background-repeat: no-repeat; background-image: conic-gradient(transparent 0deg, transparent 270deg, #00f3ff 360deg); animation: reactor-spin 4s linear infinite; }
.today-reactor::after { content: ''; position: absolute; z-index: -1; inset: 2px; background: #14141e; border-radius: 6px; }
.today-number { text-shadow: 0 0 10px #00f3ff; }

/* MERCURE CORRIG√â */
@keyframes mercury-flow { 
  0% { background-position: 0% 50%; } 
  50% { background-position: 100% 50%; } 
  100% { background-position: 0% 50%; } 
}
.effect-mercury {
  position: relative;
  border: 2px solid transparent !important; /* Bordure transparente obligatoire pour le clip */
  border-radius: 12px !important;
  z-index: 0;
  background-clip: padding-box !important; /* Le contenu s'arr√™te avant la bordure */
}
/* On utilise un ::after pour faire la bordure liquide */
.effect-mercury::after {
  content: ''; 
  position: absolute; 
  inset: -2px; /* D√©passe de 2px pour faire la bordure */
  z-index: -1; 
  border-radius: inherit;
  /* CORRECTION ICI : #C0C0C0 au lieu de #silver */
  background: linear-gradient(60deg, #C0C0C0, #ffffff, #a0a0a0, #ffffff, #C0C0C0);
  background-size: 300% 300%;
  animation: mercury-flow 3s linear infinite;
}
/* Masque pour cacher le centre du gradient */
.effect-mercury::before {
  content: '';
  position: absolute;
  inset: 0;
  background: #14141e; /* Couleur de fond de la carte */
  border-radius: inherit;
  z-index: -1;
}


/* PRISME */
.effect-prism { border: 1px solid rgba(255,255,255,0.5) !important; position: relative; overflow: hidden; background: rgba(255, 255, 255, 0.05) !important; backdrop-filter: contrast(1.2); }
.effect-prism::before { content: ''; position: absolute; inset: -50%; background: conic-gradient(from 0deg, transparent 0deg, rgba(255, 0, 0, 0.2) 40deg, rgba(255, 255, 0, 0.2) 80deg, rgba(0, 255, 0, 0.2) 120deg, rgba(0, 255, 255, 0.2) 160deg, rgba(0, 0, 255, 0.2) 200deg, rgba(255, 0, 255, 0.2) 240deg, transparent 360deg); opacity: 0; transition: opacity 0.3s, transform 0.3s; transform: rotate(0deg); mix-blend-mode: color-dodge; pointer-events: none; }
.effect-prism:hover::before { opacity: 1; transform: rotate(180deg) scale(1.2); }

/* HOLO, DIVINE, NEON, MAGMA, GLITCH, PULSE (Existants) */
@keyframes holo-shine { 0% { background-position: 200% center; opacity: 0.3; } 100% { background-position: -200% center; opacity: 0.3; } }
.effect-holo { position: relative; overflow: hidden; border: 1px solid rgba(255,255,255,0.4) !important; }
.effect-holo::before { content: ''; position: absolute; inset: 0; pointer-events: none; background: linear-gradient(115deg, transparent 30%, rgba(255,255,255,0.8) 45%, rgba(255,255,255,0.8) 55%, transparent 70%); background-size: 200% 100%; mix-blend-mode: overlay; animation: holo-shine 3s infinite ease-in-out; }
@keyframes divine-pulse { 0%, 100% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.2), inset 0 0 10px rgba(255, 215, 0, 0.1); border-color: #b8860b; } 50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.6), inset 0 0 20px rgba(255, 215, 0, 0.3); border-color: #ffd700; } }
.effect-divine { animation: divine-pulse 3s infinite ease-in-out !important; border-width: 1px !important; }
.effect-neon { box-shadow: 0 0 10px #d04fd7, inset 0 0 10px rgba(0, 243, 255, 0.2); border: 1px solid #00f3ff !important; }
@keyframes magma-flow { 0% { border-color: #ef4444; box-shadow: 0 0 10px #ef4444; } 50% { border-color: #f59e0b; box-shadow: 0 0 20px #f59e0b; } 100% { border-color: #ef4444; box-shadow: 0 0 10px #ef4444; } }
.effect-magma { animation: magma-flow 2s infinite alternate !important; }
@keyframes glitch-shake { 0% { transform: translate(0); } 20% { transform: translate(-2px, 2px); } 40% { transform: translate(-2px, -2px); } 60% { transform: translate(2px, 2px); } 80% { transform: translate(2px, -2px); } 100% { transform: translate(0); } }
.effect-glitch:hover { animation: glitch-shake 0.2s cubic-bezier(.36,.07,.19,.97) both infinite; filter: contrast(1.2) hue-rotate(10deg); }
@keyframes pulse-beat { 0% { transform: scale(1); } 15% { transform: scale(1.02); } 30% { transform: scale(1); } 45% { transform: scale(1.02); } 100% { transform: scale(1); } }
.effect-pulse { animation: pulse-beat 2s infinite; border-color: #ef4444 !important; }

/* --- EFFETS INTELLIGENTS --- */
@keyframes heat-pulse { 0% { box-shadow: inset 0 0 20px #4a0d00; } 50% { box-shadow: inset 0 0 60px #ff4500; } 100% { box-shadow: inset 0 0 20px #4a0d00; } }
.smart-heat { background: linear-gradient(45deg, #2a0a00, #5a1a00) !important; border: 1px solid #ff4500 !important; animation: heat-pulse 3s infinite ease-in-out !important; position: relative; overflow: hidden; }
.smart-heat::after { content: 'üî•'; position: absolute; bottom: -5px; right: 5px; font-size: 40px; opacity: 0.2; filter: blur(2px); }

@keyframes warp-speed { 0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; } 20% { opacity: 1; } 100% { transform: translate(-50%, -50%) scale(4); opacity: 0; } }
.smart-speed { background-color: #020617 !important; border: 1px solid #00f3ff !important; position: relative; overflow: hidden; z-index: 0; }
.smart-speed::after { content: ''; position: absolute; top: 50%; left: 50%; width: 100%; height: 100%; transform: translate(-50%, -50%); background: radial-gradient(circle, rgba(0, 243, 255, 0.2) 0%, transparent 40%); z-index: -1; }
.smart-speed::before { content: ''; position: absolute; top: 50%; left: 50%; width: 100%; height: 100%; background-image: radial-gradient(2px 2px at 20px 30px, #fff, transparent), radial-gradient(2px 2px at 40px 70px, #00f3ff, transparent), radial-gradient(2px 2px at 50px 160px, #fff, transparent), radial-gradient(2px 2px at 90px 40px, #fff, transparent), radial-gradient(2px 2px at 130px 80px, #fff, transparent), radial-gradient(2px 2px at 160px 120px, #00f3ff, transparent); background-size: 200px 200px; animation: warp-speed 0.8s linear infinite; z-index: -1; }

.smart-climb::before { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: var(--climb-h, 30%); background: linear-gradient(180deg, #ffffff 0%, #cbd5e1 15%, #475569 40%, #1e293b 100%); clip-path: polygon(0% 100%, 20% 80%, 50% 0%, 80% 70%, 100% 100%); z-index: -1; transition: height 0.5s ease-out; }

/* --- CLIC --- */
@keyframes rubber { 0% { transform: scale(1); } 30% { transform: scale(1.25, 0.75); } 40% { transform: scale(0.75, 1.25); } 50% { transform: scale(1.15, 0.85); } 100% { transform: scale(1); } }
.effect-rubber { animation: rubber 0.6s ease !important; transform-origin: bottom center; }

@keyframes shockwave-circle {
  0% { transform: translate(-50%, -50%) scale(0); opacity: 1; border-width: 20px; }
  100% { transform: translate(-50%, -50%) scale(3); opacity: 0; border-width: 0px; }
}
.effect-shockwave { position: relative; overflow: visible !important; }
.effect-shockwave::before {
  content: ''; position: absolute; top: 50%; left: 50%; width: 100px; height: 100px;
  border-radius: 50%; border: 2px solid #00f3ff; background: transparent;
  transform: translate(-50%, -50%) scale(0);
  animation: shockwave-circle 0.6s ease-out forwards;
  pointer-events: none; z-index: 100;
}

@keyframes flip { 0% { transform: rotateY(0); } 50% { transform: rotateY(90deg); } 100% { transform: rotateY(0); } }
.flipping { animation: flip 0.6s ease-in-out; transform-style: preserve-3d; }

/* Black Hole */
@keyframes black-hole-implode {
  0% { transform: scale(1) rotate(0deg); filter: brightness(1); }
  40% { transform: scale(0.1) rotate(360deg); filter: brightness(0); opacity: 1; }
  50% { opacity: 0; transform: scale(0); }
  90% { opacity: 0; }
  100% { transform: scale(1); opacity: 1; filter: brightness(1); } /* Retour √† la normale */
}
.anim-blackhole {
  animation: black-hole-implode 4s cubic-bezier(0.5, 0, 0, 1) forwards !important;
  pointer-events: none;
}

/* Shatter */
@keyframes shatter-crack {
  0% { transform: scale(1); clip-path: inset(0 0 0 0); }
  20% { transform: scale(1.05) rotate(2deg); }
  40% { transform: scale(0.95) rotate(-2deg); filter: drop-shadow(0 0 10px cyan); }
  50% { opacity: 1; }
  60% { transform: scale(1.2); opacity: 0; filter: blur(4px); } /* Explosion visuelle */
  100% { opacity: 1; transform: scale(1); }
}
.anim-shatter {
  animation: shatter-crack 0.6s ease-out forwards !important;
}

/* Stealth (Lampe Torche) - Corrig√© pour √©viter les bugs */
.stealth-mode {
  position: relative;
  /* On force le sombre par d√©faut */
  border-color: rgba(255, 255, 255, 0.05) !important;
  /* On assombrit le fond de la carte */
  filter: brightness(0.8); 
  transition: border-color 0.2s, filter 0.2s;
  overflow: hidden; /* Important pour contenir le flou */
}

/* --- LE BROUILLAGE (NOUVEAU) --- */
/* Par d√©faut (quand pas survol√©), on floute tout le contenu texte */
.stealth-mode:not(:hover) > div {
  filter: blur(5px);   /* Le flou qui rend illisible */
  opacity: 0.1;        /* On devine √† peine qu'il y a du texte */
  transform: scale(0.95); /* L√©g√®re r√©tractation */
  transition: all 0.4s ease-out; /* Retour au flou lent */
}

/* On s'assure que les connecteurs de streak (si pr√©sents) ne sont pas flout√©s */
.stealth-mode:not(:hover) > .streak-connector-bronze,
.stealth-mode:not(:hover) > .streak-connector-silver,
.stealth-mode:not(:hover) > .streak-connector-gold,
.stealth-mode:not(:hover) > .streak-connector-diamond,
.stealth-mode:not(:hover) > .streak-connector-mythic {
    filter: none !important;
    opacity: 1 !important;
}

/* Quand on survole : NETTET√â IMM√âDIATE */
.stealth-mode:hover > div {
  filter: blur(0px);
  opacity: 1;
  transform: scale(1);
  transition: all 0.2s ease-in; /* R√©v√©lation rapide */
}

/* --- TA FLASHLIGHT (INCHANG√âE) --- */
.stealth-mode::after {
  content: '';
  position: absolute;
  inset: 0;
  z-index: 10;
  pointer-events: none;
  
  /* INTENSIT√â : C≈ìur blanc + d√©grad√© vers le noir */
  background: radial-gradient(
    circle 100px at var(--mouse-x, 50%) var(--mouse-y, 50%), 
    rgba(255, 255, 255, 0.3) 0%,   /* C≈ìur lumineux */
    transparent 40%,               /* La zone de r√©v√©lation */
    rgba(0, 0, 0, 0.95) 70%        /* Le noir profond autour */
  );
  
  /* MAGIE : Overlay fait ressortir les couleurs du TSS en dessous */
  mix-blend-mode: hard-light; 
  
  opacity: 0; 
  transition: opacity 0.2s ease;
}

/* AU SURVOL */
.stealth-mode:hover {
  filter: brightness(5.2); /* On illumine la carte enti√®re */
  border-color: rgba(255, 255, 255, 0.6) !important;
  box-shadow: 0 0 30px rgba(255, 255, 255, 0.15); /* Glow externe */
  z-index: 20; /* Passe au-dessus des voisins pour le glow */
}

.stealth-mode:hover::after {
  opacity: 1;
}

/* --- UTILS & STREAKS (Existants) --- */
@keyframes energy-flow {
  0% { background-position: 100% 0; }
  100% { background-position: -100% 0; }
}

/* Animation de pulsation pour les hauts niveaux */
@keyframes connector-pulse {
  0%, 100% { opacity: 0.8; filter: brightness(1); transform: translateY(-50%) scaleX(1); }
  50% { opacity: 1; filter: brightness(1.3); transform: translateY(-50%) scaleX(1.05); }
}

/* STYLE DE BASE DU CONNECTEUR */
[class^="streak-connector-"] {
  position: absolute;
  /* On recule de 12px vers la gauche : 
     6px pour traverser le trou + 6px pour s'ancrer dans la carte d'avant */
  left: -12px; 
  top: 50%;
  
  /* On √©largit le c√¢ble pour qu'il rentre bien dans la carte actuelle aussi */
  width: 24px; 
  height: 4px; /* Un peu plus √©pais pour bien voir la connexion */
  
  transform: translateY(-50%);
  z-index: 100; /* Tr√®s important : Au-dessus des bordures */
  border-radius: 4px;
  pointer-events: none;
  background-size: 200% 100%;
  animation: energy-flow 2s linear infinite;
  
  /* Une petite ombre port√©e pour d√©coller le c√¢ble du fond noir */
  filter: drop-shadow(0 2px 3px rgba(0,0,0,0.5));
}

/* La bille de connexion (Le point de soudure) */
[class^="streak-connector-"]::before {
  content: '';
  position: absolute;
  /* On place la bille tout au d√©but du c√¢ble (donc dans la carte pr√©c√©dente) */
  left: 0px; 
  top: 50%;
  transform: translateY(-50%);
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: inherit; /* Prend la couleur du parent */
  box-shadow: 0 0 10px inherit; /* Glow */
  z-index: 101;
}

.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 1000; display: flex; justify-content: center; align-items: center; animation: modal-fade 0.2s; }
.modal-content { background: #121218; border: 1px solid #333; border-radius: 16px; padding: 2rem; width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
@keyframes modal-fade { from { opacity:0; transform:scale(0.95); } to { opacity:1; transform:scale(1); } }
.streak-connector-bronze {
  background: linear-gradient(90deg, #8B4513, #cd7f32, #8B4513);
  box-shadow: 0 0 5px #cd7f32;
  opacity: 0.6;
}

/* 2. ARGENT (Propre, m√©tallique) */
.streak-connector-silver {
  background: linear-gradient(90deg, #555, #fff, #555);
  box-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
  height: 3px !important;
}

/* 3. OR (Brillant, commence √† pulser) */
.streak-connector-gold {
  background: linear-gradient(90deg, #B8860B, #ffd700, #FFF, #ffd700);
  box-shadow: 0 0 10px #ffd700, 0 0 20px rgba(255, 215, 0, 0.4);
  height: 4px !important; /* Un poil plus √©pais */
  animation: energy-flow 1.5s linear infinite, connector-pulse 2s infinite ease-in-out !important;
}

/* 4. DIAMANT (√âlectrique, Cyan) */
.streak-connector-diamond {
  background: linear-gradient(90deg, #00f3ff, #e0ffff, #00f3ff);
  box-shadow: 0 0 12px #00f3ff, 0 0 25px rgba(0, 243, 255, 0.6);
  height: 4px !important;
  animation: energy-flow 1s linear infinite, connector-pulse 1.5s infinite ease-in-out !important;
}

/* 5. MYTHIQUE (Le flux ultime, Violet/Magenta) */
.streak-connector-mythic {
  background: linear-gradient(90deg, #d04fd7, #fff, #00f3ff, #d04fd7);
  box-shadow: 0 0 15px #d04fd7, 0 0 30px #00f3ff;
  height: 5px !important;
  animation: energy-flow 0.8s linear infinite, connector-pulse 1s infinite ease-in-out !important;
}
[class^="week-"] {
  position: absolute;
  left: 2px; right: 2px;
  bottom: 0px;
  height: 2px;
  border-radius: 2px;
  opacity: 0.8;
  z-index: 5;
}

.week-silver-glow { background: #c0c0c0; box-shadow: 0 -2px 10px rgba(192, 192, 192, 0.5); }
.week-gold-glow { background: #ffd700; box-shadow: 0 -3px 15px rgba(255, 215, 0, 0.6); height: 3px; }
.week-diamond-glow { background: #00f3ff; box-shadow: 0 -4px 20px rgba(0, 243, 255, 0.7); height: 3px; }
.week-mythic-glow { 
    background: linear-gradient(90deg, #d04fd7, #00f3ff); 
    box-shadow: 0 -5px 25px rgba(208, 79, 215, 0.8); 
    height: 4px;
}
@keyframes smooth-flow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }